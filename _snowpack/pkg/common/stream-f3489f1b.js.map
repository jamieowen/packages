{"version":3,"file":"stream-f3489f1b.js","sources":["../../../../../node_modules/@thi.ng/rstream/stream.js"],"sourcesContent":["import { isFunction } from \"@thi.ng/checks\";\nimport { CloseMode, LOGGER, } from \"./api\";\nimport { Subscription } from \"./subscription\";\nimport { optsWithID } from \"./utils/idgen\";\nexport function stream(src, opts) {\n    return new Stream(src, opts);\n}\n/**\n * Syntax sugar for {@link stream}. Creates new stream which is\n * immediately seeded with initial `val` and configured with optional\n * `opts`.\n *\n * @param val -\n * @param opts -\n */\nexport const reactive = (val, opts) => {\n    const res = new Stream(opts);\n    res.next(val);\n    return res;\n};\nexport class Stream extends Subscription {\n    // prettier-ignore\n    constructor(src, opts) {\n        const [_src, _opts] = isFunction(src) ? [src, opts] : [undefined, src];\n        super(undefined, optsWithID(\"stream\", _opts));\n        this.src = _src;\n        this._inited = false;\n    }\n    subscribe(...args) {\n        const wrapped = super.subscribe.apply(this, args);\n        if (!this._inited) {\n            this._cancel = (this.src && this.src(this)) || (() => void 0);\n            this._inited = true;\n        }\n        return wrapped;\n    }\n    unsubscribe(sub) {\n        const res = super.unsubscribe(sub);\n        if (res &&\n            (!sub ||\n                ((!this.subs || !this.subs.length) &&\n                    this.closeOut !== CloseMode.NEVER))) {\n            this.cancel();\n        }\n        return res;\n    }\n    done() {\n        this.cancel();\n        super.done();\n        delete this.src;\n        delete this._cancel;\n    }\n    error(e) {\n        super.error(e);\n        this.cancel();\n    }\n    cancel() {\n        if (this._cancel) {\n            LOGGER.debug(this.id, \"cancel\");\n            const f = this._cancel;\n            delete this._cancel;\n            f();\n        }\n    }\n}\n"],"names":[],"mappings":";;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACY,MAAC,QAAQ,GAAG,CAAC,GAAG,EAAE,IAAI,KAAK;AACvC,IAAI,MAAM,GAAG,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC;AACjC,IAAI,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAClB,IAAI,OAAO,GAAG,CAAC;AACf,EAAE;AACK,MAAM,MAAM,SAAS,YAAY,CAAC;AACzC;AACA,IAAI,WAAW,CAAC,GAAG,EAAE,IAAI,EAAE;AAC3B,QAAQ,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;AAC/E,QAAQ,KAAK,CAAC,SAAS,EAAE,UAAU,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC;AACtD,QAAQ,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;AACxB,QAAQ,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;AAC7B,KAAK;AACL,IAAI,SAAS,CAAC,GAAG,IAAI,EAAE;AACvB,QAAQ,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC1D,QAAQ,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AAC3B,YAAY,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,MAAM,KAAK,CAAC,CAAC,CAAC;AAC1E,YAAY,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AAChC,SAAS;AACT,QAAQ,OAAO,OAAO,CAAC;AACvB,KAAK;AACL,IAAI,WAAW,CAAC,GAAG,EAAE;AACrB,QAAQ,MAAM,GAAG,GAAG,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;AAC3C,QAAQ,IAAI,GAAG;AACf,aAAa,CAAC,GAAG;AACjB,iBAAiB,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM;AACjD,oBAAoB,IAAI,CAAC,QAAQ,KAAK,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE;AACzD,YAAY,IAAI,CAAC,MAAM,EAAE,CAAC;AAC1B,SAAS;AACT,QAAQ,OAAO,GAAG,CAAC;AACnB,KAAK;AACL,IAAI,IAAI,GAAG;AACX,QAAQ,IAAI,CAAC,MAAM,EAAE,CAAC;AACtB,QAAQ,KAAK,CAAC,IAAI,EAAE,CAAC;AACrB,QAAQ,OAAO,IAAI,CAAC,GAAG,CAAC;AACxB,QAAQ,OAAO,IAAI,CAAC,OAAO,CAAC;AAC5B,KAAK;AACL,IAAI,KAAK,CAAC,CAAC,EAAE;AACb,QAAQ,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACvB,QAAQ,IAAI,CAAC,MAAM,EAAE,CAAC;AACtB,KAAK;AACL,IAAI,MAAM,GAAG;AACb,QAAQ,IAAI,IAAI,CAAC,OAAO,EAAE;AAC1B,YAAY,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;AAC5C,YAAY,MAAM,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;AACnC,YAAY,OAAO,IAAI,CAAC,OAAO,CAAC;AAChC,YAAY,CAAC,EAAE,CAAC;AAChB,SAAS;AACT,KAAK;AACL;;;;"}