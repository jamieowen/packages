{"version":3,"file":"event-055cdf9a.js","sources":["../../../../../node_modules/@thi.ng/rstream/stream-merge.js","../../../../../node_modules/@thi.ng/rstream/from/event.js"],"sourcesContent":["import { State } from \"./api\";\nimport { Subscription } from \"./subscription\";\nimport { isFirstOrLastInput } from \"./utils/checks\";\nimport { optsWithID } from \"./utils/idgen\";\n/**\n * Returns a new {@link StreamMerge} subscription, consuming values from\n * multiple inputs and passing received values on to any subscribers.\n *\n * @remarks\n * Input streams can be added and removed dynamically. By default,\n * `StreamMerge` calls {@link ISubscriber.done} when the last active\n * input is done, but this behavior can be overridden via the provided\n * {@link StreamMergeOpts | options}.\n *\n * @example\n * ```ts\n * merge({\n *     // input streams w/ different frequencies\n *     src: [\n *         fromIterable([1, 2, 3], { delay: 10 }),\n *         fromIterable([10, 20, 30], { delay: 21 }),\n *         fromIterable([100, 200, 300], { delay: 7 })\n *     ]\n * }).subscribe(trace());\n * // 100\n * // 1\n * // 200\n * // 10\n * // 2\n * // 300\n * // 3\n * // 20\n * // 30\n * ```\n *\n * @example\n * Use the {@link @thi.ng/transducers#(labeled:1)} transducer for each\n * input to create a stream of labeled values and track their provenance:\n *\n * @example\n * ```ts\n * merge({\n *     src: [\n *         fromIterable([1, 2, 3]).transform(tx.labeled(\"a\")),\n *         fromIterable([10, 20, 30]).transform(tx.labeled(\"b\")),\n *     ]\n * }).subscribe(trace());\n * // [\"a\", 1]\n * // [\"b\", 10]\n * // [\"a\", 2]\n * // [\"b\", 20]\n * // [\"a\", 3]\n * // [\"b\", 30]\n * ```\n *\n * @param opts -\n */\nexport const merge = (opts) => new StreamMerge(opts);\nexport class StreamMerge extends Subscription {\n    constructor(opts) {\n        opts = opts || {};\n        super(undefined, optsWithID(\"streammerge\", opts));\n        this.sources = new Map();\n        opts.src && this.addAll(opts.src);\n    }\n    add(src) {\n        this.ensureState();\n        this.sources.set(src, src.subscribe({\n            next: (x) => x instanceof Subscription ? this.add(x) : this.next(x),\n            done: () => this.markDone(src),\n            __owner: this,\n        }, { id: `in-${src.id}` }));\n    }\n    addAll(src) {\n        for (let s of src) {\n            this.add(s);\n        }\n    }\n    remove(src) {\n        const sub = this.sources.get(src);\n        if (sub) {\n            this.sources.delete(src);\n            sub.unsubscribe();\n            return true;\n        }\n        return false;\n    }\n    removeID(id) {\n        for (let s of this.sources) {\n            if (s[0].id === id) {\n                return this.remove(s[0]);\n            }\n        }\n        return false;\n    }\n    removeAll(src) {\n        let ok = true;\n        for (let s of src) {\n            ok = this.remove(s) && ok;\n        }\n        return ok;\n    }\n    removeAllIDs(ids) {\n        let ok = true;\n        for (let id of ids) {\n            ok = this.removeID(id) && ok;\n        }\n        return ok;\n    }\n    unsubscribe(sub) {\n        if (!sub) {\n            for (let s of this.sources.values()) {\n                s.unsubscribe();\n            }\n            this.state = State.DONE;\n            this.sources.clear();\n        }\n        return super.unsubscribe(sub);\n    }\n    markDone(src) {\n        this.remove(src);\n        isFirstOrLastInput(this.closeIn, this.sources.size) && this.done();\n    }\n}\n","import { Stream } from \"../stream\";\nimport { optsWithID } from \"../utils/idgen\";\n/**\n * Creates a {@link Stream} of events attached to given element / event\n * target and using given event listener options (same as supported by\n * `addEventListener()`, default: false).\n *\n * @param src - event target\n * @param name - event name\n * @param listenerOpts - listener opts\n * @param streamOpts - stream opts\n */\nexport const fromEvent = (src, name, listenerOpts = false, streamOpts) => new Stream((stream) => {\n    let listener = (e) => stream.next(e);\n    src.addEventListener(name, listener, listenerOpts);\n    return () => src.removeEventListener(name, listener, listenerOpts);\n}, optsWithID(`event-${name}`, streamOpts));\n/**\n * Same as {@link fromEvent}, however only supports well-known DOM event\n * names. Returned stream instance will use corresponding concrete event\n * type in its type signature, whereas {@link fromEvent} will only use the\n * generic `Event`.\n *\n * @example\n * ```ts\n * fromDOMEvent(document.body, \"mousemove\"); // Stream<MouseEvent>\n * fromEvent(document.body, \"mousemove\"); // Stream<Event>\n * ```\n *\n * Also see: {@link fromEvent}\n *\n * @param src -\n * @param name -\n * @param listenerOpts -\n * @param streamOpts -\n */\nexport const fromDOMEvent = (src, name, listenerOpts = false, streamOpts) => fromEvent(src, name, listenerOpts, streamOpts);\n"],"names":[],"mappings":"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"}