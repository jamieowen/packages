{
  "version": 3,
  "sources": ["/Users/jamieowen/Workspace/packages/packages/browser/src/keyboard-stream.ts"],
  "sourcesContent": ["import { merge, fromDOMEvent } from \"@thi.ng/rstream\";\nimport { map } from \"@thi.ng/transducers\";\n\ntype KeyStreamParams = {\n  // keys to listenn and update state. All events will still be emitted.\n  listen: string[];\n  // keys to store a toggled state\n  toggle: string[];\n};\n\ntype KeyEventId = \"keyup\" | \"keydown\";\nconst events: KeyEventId[] = [\"keydown\", \"keyup\"];\n\nexport const keyboardStream = (\n  params?: Partial<KeyStreamParams>,\n  target: HTMLElement | Window = window\n) => {\n  const src = events.map((type) => fromDOMEvent<KeyEventId>(target, type));\n\n  const { listen = [], toggle = [] } = params;\n  const state = {\n    isKeyDown: false,\n    keysDown: [],\n    keysToggled: [],\n  };\n\n  return merge({\n    src,\n    xform: map((ev: KeyboardEvent) => {\n      const idx = state.keysDown.indexOf(ev.key);\n      const shouldListen = listen.indexOf(ev.key) > -1;\n\n      switch (ev.type) {\n        case \"keyup\":\n          if (shouldListen && idx > -1) {\n            state.keysDown.splice(idx, 1);\n          }\n          const shouldToggle = toggle.indexOf(ev.key) > -1;\n          const togIdx = state.keysToggled.indexOf(ev.key);\n          if (shouldToggle && togIdx === -1) {\n            state.keysToggled.push(ev.key);\n          } else if (shouldToggle && togIdx > -1) {\n            state.keysToggled.splice(togIdx, 1);\n          }\n          break;\n        case \"keydown\":\n          if (shouldListen && idx === -1) {\n            state.keysDown.push(ev.key);\n          }\n          break;\n      }\n\n      return {\n        ...state,\n        event: ev,\n        isKeyDown: state.keysDown.length > 0,\n        isKeyToggled: state.keysToggled.length > 0,\n      };\n    }),\n  });\n};\n"],
  "mappings": "AAAA;AACA;AAUA,MAAM,SAAuB,CAAC,WAAW;AAElC,aAAM,iBAAiB,CAC5B,QACA,SAA+B,WAC5B;AACH,QAAM,MAAM,OAAO,IAAI,CAAC,SAAS,aAAyB,QAAQ;AAElE,QAAM,CAAE,SAAS,IAAI,SAAS,MAAO;AACrC,QAAM,QAAQ;AAAA,IACZ,WAAW;AAAA,IACX,UAAU;AAAA,IACV,aAAa;AAAA;AAGf,SAAO,MAAM;AAAA,IACX;AAAA,IACA,OAAO,IAAI,CAAC,OAAsB;AAChC,YAAM,MAAM,MAAM,SAAS,QAAQ,GAAG;AACtC,YAAM,eAAe,OAAO,QAAQ,GAAG,OAAO;AAE9C,cAAQ,GAAG;AAAA,aACJ;AACH,cAAI,gBAAgB,MAAM,IAAI;AAC5B,kBAAM,SAAS,OAAO,KAAK;AAAA;AAE7B,gBAAM,eAAe,OAAO,QAAQ,GAAG,OAAO;AAC9C,gBAAM,SAAS,MAAM,YAAY,QAAQ,GAAG;AAC5C,cAAI,gBAAgB,WAAW,IAAI;AACjC,kBAAM,YAAY,KAAK,GAAG;AAAA,qBACjB,gBAAgB,SAAS,IAAI;AACtC,kBAAM,YAAY,OAAO,QAAQ;AAAA;AAEnC;AAAA,aACG;AACH,cAAI,gBAAgB,QAAQ,IAAI;AAC9B,kBAAM,SAAS,KAAK,GAAG;AAAA;AAEzB;AAAA;AAGJ,aAAO;AAAA,WACF;AAAA,QACH,OAAO;AAAA,QACP,WAAW,MAAM,SAAS,SAAS;AAAA,QACnC,cAAc,MAAM,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;",
  "names": []
}
