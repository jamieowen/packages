{
  "version": 3,
  "sources": ["/Users/jamieowen/Workspace/packages/packages/three/src/geometry/GeometryFactory.ts"],
  "sourcesContent": ["import { Fn0 } from \"@thi.ng/api\";\nimport { memoize1 } from \"@thi.ng/memoize\";\nimport { BufferGeometry, Matrix4, Vector3 } from \"three\";\n\nexport enum GeometryAlignment {\n  CENTER = \"center\",\n  BOTTOM = \"bottom\",\n  TOP = \"top\",\n  LEFT = \"left\",\n  RIGHT = \"right\",\n  FRONT = \"front\",\n  BACK = \"back\",\n}\n\nexport type GeometryId = \"plane\" | \"sphere\" | \"box\" | \"circle\";\n\ntype FactoryFn = Fn0<BufferGeometry>;\ntype Factory = {\n  handle: boolean;\n  create: FactoryFn;\n};\n\nexport class GeometryFactory<T = GeometryId> {\n  map: Map<T, Factory> = new Map();\n\n  register(id: T, create: FactoryFn) {\n    const createForAlignment = memoize1<GeometryAlignment, BufferGeometry>(\n      (alignment) => {\n        const geom = create();\n        return alignGeometry[alignment](geom);\n      }\n    );\n    const alignments = Object.values(GeometryAlignment);\n    alignments.forEach((align) => {\n      const lookup = this.getID(id, align);\n      this.map.set(lookup as any, {\n        handle: false,\n        create: () => createForAlignment(align),\n      });\n    });\n  }\n\n  private getID(id: T, alignment: GeometryAlignment) {\n    return [id, alignment].join(\"/\");\n  }\n\n  create(\n    id: T,\n    alignment: GeometryAlignment = GeometryAlignment.CENTER\n  ): BufferGeometry {\n    const lookup = this.getID(id, alignment);\n    return this.map.get(lookup as any).create();\n  }\n}\n\ntype ApplyGeometryAlignment = (geometry: BufferGeometry) => BufferGeometry;\n\nconst boundingBox = (geometry: BufferGeometry) => {\n  if (!geometry.boundingBox) {\n    geometry.computeBoundingBox();\n  }\n  return geometry.boundingBox;\n};\n\nexport const alignGeometry: {\n  [key in GeometryAlignment]: ApplyGeometryAlignment;\n} = {\n  [GeometryAlignment.CENTER]: (geometry) => {\n    return geometry;\n  },\n  [GeometryAlignment.BOTTOM]: (geometry) => {\n    const bounds = boundingBox(geometry);\n    return geometry.applyMatrix4(\n      new Matrix4().makeTranslation(0, -bounds.min.y, 0)\n    );\n  },\n  [GeometryAlignment.TOP]: (geometry) => {\n    const bounds = boundingBox(geometry);\n    return geometry.applyMatrix4(\n      new Matrix4().makeTranslation(0, bounds.min.y, 0)\n    );\n  },\n  [GeometryAlignment.LEFT]: (geometry) => {\n    const bounds = boundingBox(geometry);\n    return geometry.applyMatrix4(\n      new Matrix4().makeTranslation(-bounds.min.x, 0, 0)\n    );\n  },\n  [GeometryAlignment.RIGHT]: (geometry) => {\n    const bounds = boundingBox(geometry);\n    return geometry.applyMatrix4(\n      new Matrix4().makeTranslation(bounds.min.x, 0, 0)\n    );\n  },\n  [GeometryAlignment.FRONT]: (geometry) => {\n    const bounds = boundingBox(geometry);\n    return geometry.applyMatrix4(\n      new Matrix4().makeTranslation(0, 0, bounds.min.z)\n    );\n  },\n  [GeometryAlignment.BACK]: (geometry) => {\n    const bounds = boundingBox(geometry);\n    return geometry.applyMatrix4(\n      new Matrix4().makeTranslation(0, 0, -bounds.min.z)\n    );\n  },\n};\n"],
  "mappings": "AACA;AACA;AAEO,WAAK;AAAL,UAAK,oBAAL;AACL,iCAAS;AACT,iCAAS;AACT,8BAAM;AACN,+BAAO;AACP,gCAAQ;AACR,gCAAQ;AACR,+BAAO;AAAA,GAPG;AAkBL,6BAAsC;AAAA,EAAtC,cAtBP;AAuBE,eAAuB,IAAI;AAAA;AAAA,EAE3B,SAAS,IAAO,QAAmB;AACjC,UAAM,qBAAqB,SACzB,CAAC,cAAc;AACb,YAAM,OAAO;AACb,aAAO,cAAc,WAAW;AAAA;AAGpC,UAAM,aAAa,OAAO,OAAO;AACjC,eAAW,QAAQ,CAAC,UAAU;AAC5B,YAAM,SAAS,KAAK,MAAM,IAAI;AAC9B,WAAK,IAAI,IAAI,QAAe;AAAA,QAC1B,QAAQ;AAAA,QACR,QAAQ,MAAM,mBAAmB;AAAA;AAAA;AAAA;AAAA,EAK/B,MAAM,IAAO,WAA8B;AACjD,WAAO,CAAC,IAAI,WAAW,KAAK;AAAA;AAAA,EAG9B,OACE,IACA,YAA+B,kBAAkB,QACjC;AAChB,UAAM,SAAS,KAAK,MAAM,IAAI;AAC9B,WAAO,KAAK,IAAI,IAAI,QAAe;AAAA;AAAA;AAMvC,MAAM,cAAc,CAAC,aAA6B;AAChD,MAAI,CAAC,SAAS,aAAa;AACzB,aAAS;AAAA;AAEX,SAAO,SAAS;AAAA;AAGX,aAAM,gBAET;AAAA,GACD,kBAAkB,SAAS,CAAC,aAAa;AACxC,WAAO;AAAA;AAAA,GAER,kBAAkB,SAAS,CAAC,aAAa;AACxC,UAAM,SAAS,YAAY;AAC3B,WAAO,SAAS,aACd,IAAI,UAAU,gBAAgB,GAAG,CAAC,OAAO,IAAI,GAAG;AAAA;AAAA,GAGnD,kBAAkB,MAAM,CAAC,aAAa;AACrC,UAAM,SAAS,YAAY;AAC3B,WAAO,SAAS,aACd,IAAI,UAAU,gBAAgB,GAAG,OAAO,IAAI,GAAG;AAAA;AAAA,GAGlD,kBAAkB,OAAO,CAAC,aAAa;AACtC,UAAM,SAAS,YAAY;AAC3B,WAAO,SAAS,aACd,IAAI,UAAU,gBAAgB,CAAC,OAAO,IAAI,GAAG,GAAG;AAAA;AAAA,GAGnD,kBAAkB,QAAQ,CAAC,aAAa;AACvC,UAAM,SAAS,YAAY;AAC3B,WAAO,SAAS,aACd,IAAI,UAAU,gBAAgB,OAAO,IAAI,GAAG,GAAG;AAAA;AAAA,GAGlD,kBAAkB,QAAQ,CAAC,aAAa;AACvC,UAAM,SAAS,YAAY;AAC3B,WAAO,SAAS,aACd,IAAI,UAAU,gBAAgB,GAAG,GAAG,OAAO,IAAI;AAAA;AAAA,GAGlD,kBAAkB,OAAO,CAAC,aAAa;AACtC,UAAM,SAAS,YAAY;AAC3B,WAAO,SAAS,aACd,IAAI,UAAU,gBAAgB,GAAG,GAAG,CAAC,OAAO,IAAI;AAAA;AAAA;",
  "names": []
}
