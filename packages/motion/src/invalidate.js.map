{
  "version": 3,
  "sources": ["/Users/jamieowen/Workspace/packages/packages/motion/src/invalidate.ts"],
  "sourcesContent": ["import { set2, set3, Vec } from \"@thi.ng/vectors\";\nimport { filter } from \"@thi.ng/transducers\";\nimport { IMotionEvent } from \"./api\";\n/**\n *\n * Invalidate against a single value,\n * Returning a simple true/false.\n *\n * @param isInvalid\n * @param init\n */\nexport const invalidate = <T>(\n  isInvalid: (existing: T, next: T) => boolean,\n  init?: T // not sure if an init value is needed?\n) => {\n  let last = init;\n  return filter<T>((x) => {\n    if (isInvalid(last, x) || last === undefined) {\n      last = x;\n      return false;\n    } else {\n      last = x;\n      return true;\n    }\n  });\n};\n\nexport const invalidatePosition = () => {\n  let prev: Vec = [];\n  return filter<IMotionEvent<\"particle\" | \"transform\">>((x) => {\n    const changed =\n      x.data.position[0] !== prev[0] ||\n      x.data.position[1] !== prev[1] ||\n      x.data.position[2] !== prev[2];\n\n    if (changed) {\n      set3(prev, x.data.position);\n    }\n    return changed;\n  });\n};\n\nexport const invalidatePositionThreshold = (threshold: number = 0.01) => {\n  let prev: Vec = [];\n  return filter<IMotionEvent<\"particle\" | \"transform\">>((x) => {\n    const curr = x.data.position;\n    const changed =\n      (curr[0] > prev[0] + threshold && curr[0] < prev[0] - threshold) ||\n      (curr[1] > prev[1] + threshold && curr[1] < prev[1] - threshold) ||\n      (curr[2] > prev[2] + threshold && curr[2] < prev[2] - threshold);\n\n    if (changed) {\n      set3(prev, x.data.position);\n    }\n    return changed;\n  });\n};\n"],
  "mappings": "AAAA;AACA;AAUO,aAAM,aAAa,CACxB,WACA,SACG;AACH,MAAI,OAAO;AACX,SAAO,OAAU,CAAC,MAAM;AACtB,QAAI,UAAU,MAAM,MAAM,SAAS,QAAW;AAC5C,aAAO;AACP,aAAO;AAAA,WACF;AACL,aAAO;AACP,aAAO;AAAA;AAAA;AAAA;AAKN,aAAM,qBAAqB,MAAM;AACtC,MAAI,OAAY;AAChB,SAAO,OAA+C,CAAC,MAAM;AAC3D,UAAM,UACJ,EAAE,KAAK,SAAS,OAAO,KAAK,MAC5B,EAAE,KAAK,SAAS,OAAO,KAAK,MAC5B,EAAE,KAAK,SAAS,OAAO,KAAK;AAE9B,QAAI,SAAS;AACX,WAAK,MAAM,EAAE,KAAK;AAAA;AAEpB,WAAO;AAAA;AAAA;AAIJ,aAAM,8BAA8B,CAAC,YAAoB,SAAS;AACvE,MAAI,OAAY;AAChB,SAAO,OAA+C,CAAC,MAAM;AAC3D,UAAM,OAAO,EAAE,KAAK;AACpB,UAAM,UACH,KAAK,KAAK,KAAK,KAAK,aAAa,KAAK,KAAK,KAAK,KAAK,aACrD,KAAK,KAAK,KAAK,KAAK,aAAa,KAAK,KAAK,KAAK,KAAK,aACrD,KAAK,KAAK,KAAK,KAAK,aAAa,KAAK,KAAK,KAAK,KAAK;AAExD,QAAI,SAAS;AACX,WAAK,MAAM,EAAE,KAAK;AAAA;AAEpB,WAAO;AAAA;AAAA;",
  "names": []
}
